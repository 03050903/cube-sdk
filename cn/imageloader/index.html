<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="A android development framework. It make loading image and network request easy.">
<meta name="keywords" content="Cube-SDK, Android development framework, Image Loader, Easy netwrok request.">
<meta name="author" content="liaohuqiu@gmail.com">

<title>
  
  Image Loader &middot; Cube SDK
  
</title>

<!-- Bootstrap core CSS -->
<link href="/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Documentation extras -->
<link href="/assets/css/docs.min.css" rel="stylesheet">
<!--[if lt IE 9]><script src="../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Favicons -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/ico/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/assets/ico/favicon.ico">

<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-43024238-2']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  </head>
  <body>
    <a class="sr-only" href="#content">Skip to main content</a>

    <!-- Docs master nav -->
    <header class="navbar navbar-static-top bs-docs-nav" role="banner">
    <div class="container">
        
        <div class="navbar-header">
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/cn" class="navbar-brand">Cube</a>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
            <ul class="nav navbar-nav">
                
                <li>
                <a href="/cn/imageloader">图片加载组件</a>
                </li>
                
                <li>
                <a href="/cn/request">网络请求</a>
                </li>
                
            </ul>
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                <a href="/">English Version</a>
                </li>
                
                <li>
                <a href="/cn">中文版文档</a>
                </li>
                
                <li>
                <a href="https://github.com/liaohuqiu/cube-sdk">Fork on Github</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


    <!-- Docs page layout -->
    <div class="bs-header" id="content">
      <div class="container">
        <h1>Image Loader</h1>
        <p>简单，高效地加载图片</p>
      </div>
    </div>

    <div class="container bs-docs-container">

      <div class="row">
        <div class="col-md-9" role="main">
          <h1>ImageLoader</h1>

<hr>

<p class='lead'><code>ImageLoader</code> 是图片加载组件的核心。</p>

<h1>非常简单的用法</h1>

<hr>

<p class='lead'>一共三步：</p>

<ol>
<li><p>首先，创建一个<code>ImageLoader</code>:</p>
<div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="n">Context</span> <span class="n">context</span><span class="o">;</span>
<span class="n">ImageLoader</span> <span class="n">imageLoader</span> <span class="o">=</span> <span class="n">ImageLoaderFatory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</code></pre></div></li>
<li><p>用<code>findViewById()</code>找到要加载图片的<code>ImageView</code>：</p>
<div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="n">CubeImageView</span> <span class="n">imageView</span> <span class="o">=</span> <span class="o">(</span><span class="n">CubeImageView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">iv_item_image_list_big</span><span class="o">);</span>
</code></pre></div>
<p>这里留意一下：<code>CubeImageView</code> 是 <code>ImageView</code> 的子类, 在xml布局文件中应该这样写:</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
    <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
    <span class="na">android:orientation=</span><span class="s">&quot;vertical&quot;</span> <span class="nt">&gt;</span>

    <span class="c">&lt;!-- 用定制的CubeImageView --&gt;</span>
    <span class="nt">&lt;com.srain.cube.image.CubeImageView</span> 
        <span class="na">android:id=</span><span class="s">&quot;@+id/iv_item_image_list_big&quot;</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
        <span class="na">android:scaleType=</span><span class="s">&quot;fitCenter&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/LinearLayout&gt;</span>
</code></pre></div></li>
<li><p>加载图片。就一句代码：</p>
<div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="n">imageView</span><span class="o">.</span><span class="na">loadImage</span><span class="o">(</span><span class="n">imageLoader</span><span class="o">,</span> <span class="n">url</span><span class="o">);</span>
</code></pre></div></li>
</ol>

<h1>工作原理</h1>

<hr>

<p class='lead'>整个加载图片的流程非常简单。</p>

<h2>加载流程：</h2>

<ol>
<li> <code>CubeImageView</code>会检查图片是否已经加载过，图片已经加载完成并已经在显示的重复请求直接忽略。</li>
<li> 检查图片是否在内存缓存中，如果再内存中，显示内存中的图片。 </li>
<li><p>否则，创建一个 <code>ImageTask</code>，传递给<code>ImageLoader</code>，<code>ImageTaskExecutor</code>会处理这个任务。 </p>

<p><code>ImageTaskExecutor</code> has an work queue, it has some threads to do the work in backgroud. If all of the threads are busy with current task, this task will put into the work queue.</p></li>
<li><p>If the image is stored in file cache, it will be decoded, or else <code>ImageProvider</code> will fetch it from remote server then store it to file cache.</p></li>
<li><p>After decoded, the process is complete. The ImageView will be notified to display this image.</p></li>
</ol>

<h2>Components</h2>

<p>There are four components used in <code>ImageLoader</code> to load image. As you can see in the construct method in the <code>ImageLoader</code>:</p>

<ul>
<li><p><code>ImageLoader</code></p>
<div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="kd">public</span> <span class="nf">ImageLoader</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> 

                        <span class="n">ImageProvider</span> <span class="n">provider</span><span class="o">,</span> 
                        <span class="n">ImageTaskExecutor</span> <span class="n">executor</span><span class="o">,</span> 
                        <span class="n">ImageResizer</span> <span class="n">resizer</span><span class="o">,</span> 
                        <span class="n">ImageLoadHandler</span> <span class="n">loadHandler</span><span class="o">)</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></div></li>
</ul>

<p>They are:</p>

<ul>
<li><p><code>ImageProvider</code></p>

<p>It managers the <code>ImageMemoryCache</code> and <code>ImageFileCache</code>; request the image from remote server; decode bitmap from file.</p></li>
<li><p><code>ImageTaskExexutor</code></p>

<p>It is an interface which extends <code>ava.util.concurrent.Executor</code>. An <code>ImageTaskExecutor</code> can execute <code>LoadImageTask</code>, it allows the task can be executed in different order.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">void setTaskOrder(ImageTaskOrder order);
void execute(Runnable command);
</code></pre></div></li>
<li><p><code>ImageResizer</code></p>

<p>It controls the <code>BitmapFactory.Options.inSampleSize</code> when decode bitmap from file and builds the network url according the request size.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">int getInSampleSize(ImageTask imageTask);
String getResizedUrl(ImageTask imageTask);
</code></pre></div></li>
<li><p><code>ImageLoadHandler</code></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">void onLoading(ImageTask imageTask, CubeImageView cubeImageView);
void onLoadFinish(ImageTask imageTask, CubeImageView cubeImageView, BitmapDrawable drawable);
</code></pre></div>
<p>When the image is loading in the backgroud thread, <code>onLoading()</code> will be called to notify the ImageView. The ImageView can display a loading image place hodler. </p>

<p>Once image is loaded, <code>onLoadFinish()</code> will be called to notify the ImageView to display the image.</p></li>
</ul>

<h1>Customize</h1>

<p class='lead'>Most of the components interface has a default implementions, you can implement for your own application.</p>

<h3>A speical loading image</h3>

<p>There are lots of ways:</p>

<ol>
<li><p>Implement the interface <code>ImageLoadHandler</code>;</p></li>
<li><p>Use the <code>DefaultImageLoadHandler</code> which implements <code>ImageLoadHandler</code>:</p>
<div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="n">DefaultImageLoadHandler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultImageLoadHandler</span><span class="o">();</span>

<span class="c1">// pick one of the following method</span>
<span class="n">handler</span><span class="o">.</span><span class="na">setLoadingBitmap</span><span class="o">(</span><span class="n">Bitmap</span> <span class="n">loadingBitmap</span><span class="o">);</span>
<span class="n">handler</span><span class="o">.</span><span class="na">setLoadingResources</span><span class="o">(</span><span class="kt">int</span> <span class="n">loadingBitmap</span><span class="o">);</span>
<span class="n">handler</span><span class="o">.</span><span class="na">setLoadingImageColor</span><span class="o">(</span><span class="kt">int</span> <span class="n">color</span><span class="o">);</span>
<span class="n">handler</span><span class="o">.</span><span class="na">setLoadingImageColor</span><span class="o">(</span><span class="n">String</span> <span class="n">colorString</span><span class="o">);</span>
</code></pre></div></li>
</ol>

<h3>Some speical effect after the image is loaded</h3>

<ol>
<li><p>You can also implement the <code>ImageLoadHandler</code>, in the <code>onLoadFinish()</code> method, you can add whatever effect you want, as long as they are based on <code>Drawable</code>.</p></li>
<li><p>In the <code>DefaultImageLoadHandler</code>, there are some effects;</p>

<ul>
<li><p><strong>Fade in</strong> by default, this effect is on.</p>
<div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="n">setImageFadeIn</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">fadeIn</span><span class="o">);</span>
</code></pre></div></li>
<li><p><strong>Rounded corner</strong></p>
<div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="n">setImageRounded</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">rouded</span><span class="o">,</span> <span class="kt">float</span> <span class="n">cornerRadius</span><span class="o">);</span>
</code></pre></div></li>
</ul></li>
</ol>

<h3>Diffrent url for diffrent size</h3>

<p>If you have a thumbnail web service which can return multiple size image according the url, you can implements this method to return the specified url according the request size.</p>

<p>That is easy:</p>
<div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">EtaoImageResizer</span> <span class="kd">extends</span> <span class="n">DefaultResizer</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getResizedUrl</span><span class="o">(</span><span class="n">ImageTask</span> <span class="n">imageTask</span><span class="o">)</span> <span class="o">{</span>

            <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">imageTask</span><span class="o">.</span><span class="na">getRequestSize</span><span class="o">().</span><span class="na">x</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="n">imageTask</span><span class="o">.</span><span class="na">getRequestSize</span><span class="o">().</span><span class="na">y</span><span class="o">;</span>

            <span class="c1">// return url according the request size</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
        </div>
        <div class="col-md-3">
          <div class="bs-sidebar hidden-print" role="complementary">
            <ul class="nav bs-sidenav">
                <!-- auto gen -->
            </ul>
          </div>
        </div>
      </div>

    </div>

    <!-- Footer
================================================== -->
<footer class="bs-footer" role="contentinfo">
  <div class="container">
  </div>
</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="/assets/js/jquery.min.js"></script>
<script src="/dist/js/bootstrap.min.js"></script>
<script src="/assets/js/docs.min.js"></script>

  </body>
</html>
